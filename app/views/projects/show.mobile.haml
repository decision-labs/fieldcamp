- content_for :head do
  %meta{"name" => "viewport", :content => "initial-scale=1.0, user-scalable=no"}
  = stylesheet_link_tag 'google'
  = javascript_include_tag 'GeoJSON', 'json-helpers'
  :javascript
    function detectBrowser() {
      var useragent = navigator.userAgent;
      var mapdiv = document.getElementById("map_canvas");

      if (useragent.indexOf('iPhone') != -1 || useragent.indexOf('Android') != -1 ) {
        mapdiv.style.width = '100%';
        mapdiv.style.height = '100%';
      } else {
        mapdiv.style.width = '600px';
        mapdiv.style.height = '600px';
      }
    }

    function initialize() {
      detectBrowser();
      // var pathname = window.location.pathname;
      var pathname = "#{project_path(@project)}"
      var myLatlng = new google.maps.LatLng(30.375, 69.345);
      var myOptions = {
        zoom: 6,
        center: myLatlng,
        mapTypeId: google.maps.MapTypeId.TERRAIN
      }
      var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

      $.getJSON(pathname+'.json', function(geojson) {
        province = new GeoJSON(geojson, null);
        province.setMap(map);
      });

      $.getJSON(pathname+'/events.json', function(geojson) {
        $.each(geojson.features, function(i, feature) {
          var event_marker = new GeoJSON(feature.geometry, null);
          event_marker.setMap(map);
          var content_string = renderJSON(feature.properties);
          var info_window = new google.maps.InfoWindow({content: content_string});
          google.maps.event.addListener(event_marker, 'click', function() {
            info_window.open(map, event_marker);
          });
        })
      });
      google.maps.event.trigger(map, 'resize');
    }

    function loadScript() {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "http://maps.google.com/maps/api/js?sensor=false&callback=initialize";
      document.body.appendChild(script);
    }

    window.onload = loadScript;

#header{"data-role" => "header"}
  =link_to "Projects", projects_path, :rel => "external", "data-icon" => "arrow-l"
  %h1= @project.title

#content{"data-role" => "content", :style => "height:100%"}
  #map_canvas{:style => "width:100%; height:100%"}
